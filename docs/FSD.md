# Functional Specification Document (FSD)
## Revenue Management System (RMS) v01.5

**Document Version:** 1.5.0  
**Last Updated:** 2026-02-10  
**Status:** âœ… Production  
**Author:** 4TK Hospitality Engineering

---

## 1. Document Overview

### 1.1 Purpose
TÃ i liá»‡u nÃ y mÃ´ táº£ chi tiáº¿t **hÃ nh vi chá»©c nÄƒng** cá»§a tá»«ng module trong RMS, bao gá»“m:
- Input/Output specifications
- Business rules & logic
- UI behavior & interactions
- State transitions
- Integration points

### 1.2 Scope
Bao gá»“m táº¥t cáº£ cÃ¡c module production cá»§a RMS v01.4.

### 1.3 Related Documents
| Document | Purpose |
|----------|---------|
| [SRS.md](./SRS.md) | Requirements tá»•ng quan |
| [TECHNICAL_SPEC.md](./TECHNICAL_SPEC.md) | Kiáº¿n trÃºc ká»¹ thuáº­t |
| [PRD_FRD.md](./PRD_FRD.md) | Product & Functional Requirements |

---

## 2. Module: Authentication

### 2.1 Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOGIN FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    RMS                     Google              DB
 â”‚                       â”‚                        â”‚                  â”‚
 â”‚â”€â”€[1] Click Loginâ”€â”€â”€â”€â”€â–¶â”‚                        â”‚                  â”‚
 â”‚                       â”‚â”€â”€[2] Redirectâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
 â”‚                       â”‚                        â”‚                  â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€[3] OAuth Callbackâ”€â”€â”€â”‚                  â”‚
 â”‚                       â”‚                        â”‚                  â”‚
 â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[4] Check/Create Userâ”€â”€â–¶â”‚
 â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[5] User + Hotelsâ”€â”€â”€â”€â”€â”€â”‚
 â”‚                       â”‚                        â”‚                  â”‚
 â”‚                       â”‚â”€â”€[6] Create JWTâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                       â”‚                        â”‚                  â”‚
 â”‚â—€â”€[7] Set Cookieâ”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚
 â”‚   Redirect Dashboard  â”‚                        â”‚                  â”‚
 â”‚                       â”‚                        â”‚                  â”‚
```

### 2.2 Login States

| State | Condition | Behavior |
|-------|-----------|----------|
| `NOT_AUTHENTICATED` | No JWT cookie | Redirect to /login |
| `AUTHENTICATED_NO_HOTEL` | JWT valid, no hotel_users | Redirect to /waiting |
| `AUTHENTICATED` | JWT valid, has hotel | Access granted |
| `BLOCKED` | User is_active = false | Show blocked message |

### 2.3 Session Management

| Property | Value |
|----------|-------|
| Session Type | JWT (httpOnly cookie) |
| Token Expiry | 30 days |
| Refresh Strategy | Automatic on page load |
| Logout | Clear cookie + redirect |

### 2.4 UI Specification: Login Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RMS Login                            â”‚
â”‚                                                         â”‚
â”‚                   [RMS Logo]                            â”‚
â”‚                                                         â”‚
â”‚           Há»‡ thá»‘ng Quáº£n lÃ½ Doanh thu                   â”‚
â”‚                                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚  ğŸ”µ ÄÄƒng nháº­p báº±ng Google       â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚         Powered by 4TK Hospitality                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Module: Data Import

### 3.1 Upload Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     UPLOAD PROCESS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DROP FILE  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VALIDATE    â”‚
                    â”‚ FILE FORMAT â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CSV    â”‚  â”‚  XML    â”‚  â”‚ INVALID â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚            â”‚            â”‚
             â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PARSE   â”‚  â”‚ PARSE   â”‚  â”‚ ERROR   â”‚
        â”‚ HEADERS â”‚  â”‚ NODES   â”‚  â”‚ MESSAGE â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚            â”‚
             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CHECK HASH  â”‚â”€â”€â”€â”€ Duplicate? â”€â”€â–¶ SKIP
            â”‚ DEDUP       â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CREATE JOB  â”‚
            â”‚ INSERT ROWS â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ SUCCESS!    â”‚
            â”‚ Show count  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 File Format Detection

| Extension | Detection Method | Parser |
|-----------|------------------|--------|
| `.csv` | File extension | Papa Parse |
| `.xml` | File extension + root node | DOM Parser |
| Unknown | Try CSV first | - |

### 3.3 CSV Field Mapping

| Source Field | Target Field | Required | Default |
|--------------|--------------|----------|---------|
| `confirmation_id` / `res_id` | reservation_id | No | Auto-gen |
| `checkin` / `arrival_date` | arrival_date | Yes | - |
| `checkout` / `departure_date` | departure_date | Yes | - |
| `rooms` / `room_count` | rooms | No | 1 |
| `revenue` / `total` | revenue | No | NULL |
| `booking_date` / `book_time` | book_time | No | NOW() |
| `status` | status | No | 'confirmed' |
| `channel` / `source` | channel_code | No | NULL |

### 3.4 XML Node Mapping (Opera Crystal Report)

```xml
<Reservation>
    <ConfirmationNumber> â†’ reservation_id
    <ArrivalDate> â†’ arrival_date
    <DepartureDate> â†’ departure_date
    <RoomCount> â†’ rooms
    <Revenue> â†’ revenue
    <BookingDate> â†’ book_time
    <Status> â†’ status
</Reservation>
```

### 3.5 Validation Rules

| Rule | Condition | Error Message |
|------|-----------|---------------|
| Required arrival | arrival_date is empty | "Thiáº¿u ngÃ y Ä‘áº¿n" |
| Required departure | departure_date is empty | "Thiáº¿u ngÃ y Ä‘i" |
| Date order | arrival >= departure | "NgÃ y Ä‘i pháº£i sau ngÃ y Ä‘áº¿n" |
| Future departure | departure < today | Warning only |
| Revenue range | revenue < 0 | "Doanh thu khÃ´ng Ä‘Æ°á»£c Ã¢m" |
| Duplicate file | hash exists | "File Ä‘Ã£ import trÆ°á»›c Ä‘Ã³" |

### 3.6 UI Specification: Upload Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¤ Upload dá»¯ liá»‡u                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚     ğŸ“ KÃ©o tháº£ file CSV hoáº·c XML vÃ o Ä‘Ã¢y                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚           â”€â”€â”€ hoáº·c â”€â”€â”€                                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚         [ Chá»n file tá»« mÃ¡y tÃ­nh ]                       â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚     Há»— trá»£: .csv, .xml (Opera, Cloudbeds, RoomRaccoon) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“‹ Lá»‹ch sá»­ upload gáº§n Ä‘Ã¢y:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ File                  â”‚ NgÃ y      â”‚ Tráº¡ng thÃ¡i â”‚ Rows   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ reservations_0902.csv â”‚ 09/02     â”‚ âœ… Success â”‚ 156    â”‚  â”‚
â”‚  â”‚ opera_export.xml      â”‚ 08/02     â”‚ âœ… Success â”‚ 203    â”‚  â”‚
â”‚  â”‚ bookings.csv          â”‚ 07/02     â”‚ âš ï¸ Partial â”‚ 89/100 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Module: OTB Engine

### 4.1 OTB Calculation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OTB CALCULATION LOGIC                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

For each stay_date in [today, today+90]:

    1. Query reservations where:
       - hotel_id = current hotel
       - book_time < cutoff (as_of_date + 1 day)
       - cancel_time IS NULL OR cancel_time >= cutoff
       - arrival_date <= stay_date < departure_date

    2. Deduplicate by reservation_id:
       - Take latest snapshot (by import_job.snapshot_ts)

    3. Aggregate:
       - rooms_otb = SUM(rooms)
       - revenue_otb = SUM(revenue / nights)
       - adr = revenue_otb / rooms_otb

    4. Upsert to daily_otb table
```

### 4.2 Time-Travel Specification

| Parameter | Description | Default |
|-----------|-------------|---------|
| `as_of_date` | Historical snapshot date | Today |
| `cutoff` | as_of_date + 1 day 00:00:00 | - |
| `timezone` | Hotel timezone | Asia/Ho_Chi_Minh |

**Example:**
```
as_of_date = 2026-02-05
cutoff = 2026-02-06 00:00:00

Query returns OTB as if viewed on Feb 5th EOD
```

### 4.3 Deduplication Logic

```sql
-- DISTINCT ON with snapshot ordering
SELECT DISTINCT ON (r.reservation_id)
    r.reservation_id,
    r.arrival_date,
    r.departure_date,
    r.rooms,
    r.revenue,
    r.book_time,
    r.cancel_time
FROM reservations_raw r
JOIN import_jobs j ON j.job_id = r.job_id
WHERE r.hotel_id = $1
ORDER BY r.reservation_id, 
         COALESCE(j.snapshot_ts, j.created_at) DESC
```

### 4.4 Cancellation Handling

| Scenario | book_time | cancel_time | OTB Status |
|----------|-----------|-------------|------------|
| Active booking | < cutoff | NULL | âœ… Counted |
| Future cancel | < cutoff | >= cutoff | âœ… Counted |
| Cancelled | < cutoff | < cutoff | âŒ Not counted |
| Future booking | >= cutoff | any | âŒ Not counted |

---

## 5. Module: Analytics Features

### 5.1 Feature Definitions

| Feature | Formula | Data Source |
|---------|---------|-------------|
| **stly_rooms_otb** | OTB[same_dow, week_of_year-52] | daily_otb |
| **stly_revenue_otb** | Revenue[same_dow, week_of_year-52] | daily_otb |
| **pickup_t7** | OTB[today] - OTB[today-7] | daily_otb |
| **pickup_t15** | OTB[today] - OTB[today-15] | daily_otb |
| **pickup_t30** | OTB[today] - OTB[today-30] | daily_otb |
| **pace_vs_ly** | (OTB[today] - STLY) / STLY * 100 | computed |
| **remaining_supply** | hotel.capacity - rooms_otb | computed |
| **dow** | Day of week (0=Sun, 6=Sat) | stay_date |
| **is_weekend** | dow IN (5, 6) | computed |

### 5.2 STLY Matching Algorithm

```typescript
function findSTLYDate(stayDate: Date): Date {
    // Target: Same day-of-week, ~52 weeks ago
    const dow = stayDate.getDay(); // 0-6
    
    // Go back exactly 52 weeks
    const yearAgo = new Date(stayDate);
    yearAgo.setDate(yearAgo.getDate() - (52 * 7));
    
    // Adjust to same DOW if needed
    const dayDiff = dow - yearAgo.getDay();
    yearAgo.setDate(yearAgo.getDate() + dayDiff);
    
    return yearAgo;
}
```

### 5.3 Approximate STLY Fallback

| Scenario | Strategy | Flag |
|----------|----------|------|
| Exact match exists | Use exact value | stly_is_approx = false |
| No exact match | Average of Â±3 days same DOW | stly_is_approx = true |
| No data at all | NULL | - |

### 5.4 UI Specification: Analytics Panel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š PhÃ¢n tÃ­ch                    [STLY] [PACE] [PICKUP]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tab: STLY (Same Time Last Year)                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  â”‚ NgÃ y       â”‚ OTB   â”‚ STLY  â”‚ ChÃªnh lá»‡ch â”‚ Trend    â”‚â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚  â”‚
â”‚  â”‚  â”‚ 10/02 (T2) â”‚ 156   â”‚ 142   â”‚ +14        â”‚ ğŸ“ˆ +10%  â”‚â”‚  â”‚
â”‚  â”‚  â”‚ 11/02 (T3) â”‚ 89    â”‚ 105   â”‚ -16        â”‚ ğŸ“‰ -15%  â”‚â”‚  â”‚
â”‚  â”‚  â”‚ 12/02 (T4) â”‚ 112   â”‚ 98    â”‚ +14        â”‚ ğŸ“ˆ +14%  â”‚â”‚  â”‚
â”‚  â”‚  â”‚ 13/02 (T5) â”‚ 78    â”‚ 82    â”‚ -4         â”‚ ğŸ“‰ -5%   â”‚â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tab: PICKUP (Sá»‘ Ä‘áº·t má»›i)                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  â”‚ NgÃ y       â”‚ T-7   â”‚ T-15  â”‚ T-30       â”‚ Trend    â”‚â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚  â”‚
â”‚  â”‚  â”‚ 10/02      â”‚ +12   â”‚ +28   â”‚ +45        â”‚ ğŸ“ˆ Strongâ”‚â”‚  â”‚
â”‚  â”‚  â”‚ 11/02      â”‚ +3    â”‚ +8    â”‚ +12        â”‚ â¡ï¸ Weak  â”‚â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Module: Dashboard

### 6.1 Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Hotel Name]              [Date Picker â–¼]          [Export PDF]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Rooms OTB  â”‚ â”‚ Remaining  â”‚ â”‚ Pickup T7  â”‚ â”‚ Cancelled  â”‚      â”‚
â”‚  â”‚    156     â”‚ â”‚    114     â”‚ â”‚    +23     â”‚ â”‚     5      â”‚      â”‚
â”‚  â”‚  â–²+12 LY   â”‚ â”‚   84% occ  â”‚ â”‚  +8% vs LY â”‚ â”‚  -2 vs LY  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [14 days] [30 days] [60 days] [90 days]                     â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  OTB Chart (Recharts Bar)                                    â”‚ â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Analytics Panel [STLY] [PACE] [PICKUP]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Recommendations Table                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ Date   â”‚ OTB â”‚ Rem â”‚ Forecast â”‚ Suggest  â”‚ Actions      â”‚â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚  â”‚  â”‚ 10/02  â”‚ 156 â”‚ 114 â”‚ 95       â”‚ 1.2M     â”‚ [âœ“] [âœï¸]    â”‚â”‚ â”‚
â”‚  â”‚  â”‚ 11/02  â”‚ 89  â”‚ 181 â”‚ 120      â”‚ 950K     â”‚ [âœ“] [âœï¸]    â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 KPI Card Specifications

| Card | Metric | Comparison | Color Logic |
|------|--------|------------|-------------|
| **Rooms OTB** | SUM rooms for stay_date | vs STLY | Green/Red |
| **Remaining Supply** | Capacity - OTB | Occupancy % | Neutral |
| **Pickup T7** | OTB change in 7 days | vs LY Pickup | Green/Red |
| **Cancelled** | Cancelled rooms today | vs LY | Red if higher |

### 6.3 Chart Specifications

| Property | Value |
|----------|-------|
| Type | Bar Chart (Recharts) |
| X-Axis | stay_date (formatted DD/MM) |
| Y-Axis | rooms_otb |
| Bars | Stacked if STLY shown |
| Colors | Primary: #3B82F6, STLY: #E5E7EB |
| Tooltip | OTB, STLY, Diff, ADR |

### 6.4 Date Range Tabs

| Tab | Range | Default | Show |
|-----|-------|---------|------|
| 14 days | Today + 14 | No | Short-term |
| 30 days | Today + 30 | **Yes** | Default |
| 60 days | Today + 60 | No | Mid-term |
| 90 days | Today + 90 | No | Long-term |

### 6.5 Accept/Override Flow

```
User clicks [âœ“ Accept]
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/price â”‚
â”‚ action: accept  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store decision  â”‚
â”‚ pricing_decisionsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update UI       â”‚
â”‚ Show âœ… Accepted â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks [âœï¸ Override]
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Open Modal      â”‚
â”‚ [Enter new price]â”‚
â”‚ [Select reason] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/price â”‚
â”‚ action: overrideâ”‚
â”‚ new_price: xxx  â”‚
â”‚ reason: xxx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store decision  â”‚
â”‚ Show âœï¸ Overriddenâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.6 Override Reason Codes

| Code | Label | Description |
|------|-------|-------------|
| `event` | Sá»± kiá»‡n Ä‘áº·c biá»‡t | Lá»… há»™i, há»™i nghá»‹... |
| `competitor` | Cáº¡nh tranh | Äá»‘i thá»§ giáº£m giÃ¡ |
| `group` | ÄoÃ n lá»›n | Booking nhÃ³m |
| `weather` | Thá»i tiáº¿t | Dá»± bÃ¡o xáº¥u/tá»‘t |
| `other` | LÃ½ do khÃ¡c | Free text |

---

## 7. Module: OTA Pricing Calculator

### 7.1 Calculation Formula

```
                        NET
BAR = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       (1 - commission) Ã— (1 - dâ‚) Ã— (1 - dâ‚‚)...

Where:
- NET = Desired net revenue per night
- commission = OTA commission rate (e.g., 0.18 for 18%)
- dâ‚, dâ‚‚... = Promotion discounts (e.g., 0.10 for 10%)
```

### 7.2 Calculation Modes

| Mode | Formula | Use Case |
|------|---------|----------|
| **Progressive** (Default) | Compound discounts | Multiple promotions |
| **Additive** | Sum discounts | Single total discount |

### 7.3 Example Calculation (Progressive)

```
Input:
  NET = 1,000,000 VND
  Commission = 18% (Agoda)
  Discounts = [10% Super Sale, 5% Member Deal]

Step 1: Add back commission
  1,000,000 / (1 - 0.18) = 1,219,512

Step 2: Add back Super Sale (10%)
  1,219,512 / (1 - 0.10) = 1,355,013

Step 3: Add back Member Deal (5%)
  1,355,013 / (1 - 0.05) = 1,426,330

Step 4: Round to nearest 1000
  BAR = 1,427,000 VND
```

### 7.4 UI Specification: Pricing Module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° TÃ­nh giÃ¡ OTA                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GiÃ¡ NET (VND):  [  1.000.000  ]                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚ Háº¡ng phÃ²ng:     [DELUXE â–¼]                              â”‚  â”‚
â”‚  â”‚ KÃªnh OTA:       [Agoda (18%) â–¼]                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚ Khuyáº¿n mÃ£i:                                              â”‚  â”‚
â”‚  â”‚ â˜‘ Super Sale         10%                                â”‚  â”‚
â”‚  â”‚ â˜‘ Member Deal         5%                                â”‚  â”‚
â”‚  â”‚ â˜ Flash Sale         15%                                â”‚  â”‚
â”‚  â”‚ â˜ Combo Package       8%                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€ OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  GIÃ HIá»‚N THá»Š (BAR):    1.427.000 VND                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                â”‚  â”‚
â”‚  â”‚  Chi tiáº¿t:                                               â”‚  â”‚
â”‚  â”‚  â€¢ NET gá»‘c:          1.000.000                          â”‚  â”‚
â”‚  â”‚  â€¢ + Hoa há»“ng Agoda:   219.512  (18%)                   â”‚  â”‚
â”‚  â”‚  â€¢ + Super Sale:       135.501  (10%)                   â”‚  â”‚
â”‚  â”‚  â€¢ + Member Deal:       71.987  (5%)                    â”‚  â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                â”‚  â”‚
â”‚  â”‚  = BAR:              1.427.000                          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  [ Xem Price Matrix ]  [ Export Excel ]                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 Price Matrix Specification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Price Matrix (NET: 1.000.000)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚           â”‚ Agoda (18%) â”‚ Booking (15%) â”‚ Expedia (20%)â”‚         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  STANDARD â”‚ 1,219,512   â”‚ 1,176,471     â”‚ 1,250,000    â”‚         â”‚
â”‚  DELUXE   â”‚ 1,463,415   â”‚ 1,411,765     â”‚ 1,500,000    â”‚         â”‚
â”‚  SUITE    â”‚ 1,951,220   â”‚ 1,882,353     â”‚ 2,000,000    â”‚         â”‚
â”‚                                                                   â”‚
â”‚  With Super Sale (-10%):                                         â”‚
â”‚           â”‚ Agoda       â”‚ Booking       â”‚ Expedia      â”‚         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  STANDARD â”‚ 1,355,014   â”‚ 1,307,190     â”‚ 1,388,889    â”‚         â”‚
â”‚  DELUXE   â”‚ 1,626,017   â”‚ 1,568,627     â”‚ 1,666,667    â”‚         â”‚
â”‚  SUITE    â”‚ 2,168,022   â”‚ 2,091,503     â”‚ 2,222,222    â”‚         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Module: User Management

### 8.1 User CRUD Operations

| Operation | Route | Permission | Fields |
|-----------|-------|------------|--------|
| List | GET /admin/users | Super Admin | All users |
| Create | POST /admin/users | Super Admin | email, name, role |
| Edit | PUT /admin/users/[id] | Super Admin | name, role, is_active |
| Assign Hotel | POST /admin/users/[id]/hotels | Super/Hotel Admin | hotel_id, role |
| Deactivate | PUT /admin/users/[id] | Super Admin | is_active = false |

### 8.2 Role Hierarchy

```
super_admin (Level 4)
     â”‚
     â”œâ”€ Can manage all hotels
     â”œâ”€ Can manage all users
     â””â”€ Full system access
     
hotel_admin (Level 3)
     â”‚
     â”œâ”€ Can manage own hotel
     â”œâ”€ Can manage hotel users
     â””â”€ Can configure pricing
     
manager (Level 2)
     â”‚
     â”œâ”€ Can upload data
     â”œâ”€ Can override prices
     â””â”€ Cannot change settings
     
viewer (Level 1)
     â”‚
     â””â”€ Read-only access
```

### 8.3 UI Specification: User List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¥ Quáº£n lÃ½ ngÆ°á»i dÃ¹ng                    [ + Má»i ngÆ°á»i dÃ¹ng ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ User            â”‚ Email              â”‚ Role    â”‚ Status  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸ‘¤ Nguyá»…n VÄƒn A â”‚ nva@hotel.com     â”‚ Admin   â”‚ ğŸŸ¢ Activeâ”‚  â”‚
â”‚  â”‚ ğŸ‘¤ Tráº§n Thá»‹ B   â”‚ ttb@hotel.com     â”‚ Manager â”‚ ğŸŸ¢ Activeâ”‚  â”‚
â”‚  â”‚ ğŸ‘¤ LÃª VÄƒn C     â”‚ lvc@hotel.com     â”‚ Viewer  â”‚ ğŸ”´ Blockedâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Module: Guide/Help

### 9.1 Guide Tabs

| Tab | Target Audience | Content |
|-----|-----------------|---------|
| **Báº¯t Ä‘áº§u nhanh** | New GMs | 5-step getting started |
| **Quáº£n lÃ½ Doanh thu** | Revenue Managers | OTB, Features, Forecast |
| **TÃ­nh giÃ¡ OTA** | All Users | NET â†’ BAR calculation |
| **OTA Growth Playbook** | Paid Users | OTA ranking optimization tools (Premium) |

### 9.2 QuickStart Steps

| Step | Title | Description |
|------|-------|-------------|
| 1 | ÄÄƒng nháº­p | Google OAuth |
| 2 | Upload dá»¯ liá»‡u | CSV/XML tá»« PMS |
| 3 | Build dá»¯ liá»‡u | OTB â†’ Features â†’ Forecast |
| 4 | Xem Dashboard | KPI, Charts, Recommendations |
| 5 | Ra quyáº¿t Ä‘á»‹nh giÃ¡ | Accept / Override |

### 9.3 OTA Growth Playbook (Premium Feature)

**Access:** Paid plan only (gated by `OTAGrowthPaywall`)

#### 9.3.1 Playbook Tabs

| Tab ID | Label (VI) | Description |
|--------|------------|-------------|
| `scorecard` | **Kiá»ƒm tra chá»‰ sá»‘ OTA** | Kiá»ƒm tra cÃ¡c chá»‰ sá»‘ trÃªn kÃªnh OTA cá»§a khÃ¡ch sáº¡n |
| `booking` | **Booking.com** | Checklist tá»‘i Æ°u ranking trÃªn Booking.com |
| `agoda` | **Agoda** | Checklist tá»‘i Æ°u ranking trÃªn Agoda |
| `roi` | **Hiá»‡u quáº£ chÆ°Æ¡ng trÃ¬nh** | Hiá»‡u quáº£ chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i â€” Lá»i hay lá»— khi tham gia chÆ°Æ¡ng trÃ¬nh OTA |
| `review` | **Äiá»ƒm Review** | MÃ´ phá»ng tÃ¡c Ä‘á»™ng cá»§a review Ä‘áº¿n Ä‘iá»ƒm sá»‘ |
| `boost` | **CÃ¡ch tÄƒng Ranking** | Khi nÃ o Boost tÄƒng Ranking â€” HÆ°á»›ng dáº«n thá»i Ä‘iá»ƒm vÃ  cÃ¡ch Ä‘áº©y ranking trÃªn OTA |

#### 9.3.2 Tab: Kiá»ƒm tra chá»‰ sá»‘ OTA (Health Scorecard)

**Component:** `OTAHealthScorecard.tsx`
**Header:** "TÃ¬nh tráº¡ng thá»© háº¡ng tá»‘t/xáº¥u"
**Subtitle:** "Kiá»ƒm tra xem ranking cá»§a khÃ¡ch sáº¡n trÃªn tá»«ng kÃªnh OTA Ä‘ang á»Ÿ má»©c tá»‘t hay cáº§n cáº£i thiá»‡n"

**Scoring Metrics (Booking.com - Total 100%):**

| Metric | Weight | Scoring |
|--------|--------|---------|
| Review Score | 25% | â‰¥8.5 = Full, 7.5â€“8.4 = Partial |
| Content Score | 15% | â‰¥90% = Full |
| Response Rate | 10% | â‰¥90% = Full |
| Commission Level | 15% | 18%+ = Full |
| Mobile Rate | 10% | Enabled = Full |
| Genius Program | 15% | Level 2+ = Full |
| Visibility Booster | 10% | Active = Full |

**Scoring Metrics (Agoda - Total 100%):**

| Metric | Weight | Scoring |
|--------|--------|---------|
| Review Score | 25% | â‰¥8.0 = Full |
| Photo Quality | 15% | â‰¥20 HD photos = Full |
| VHP Program | 15% | Active = Full |
| Commission | 15% | 20%+ = Full |
| YCS Score | 10% | â‰¥80% = Full |
| Special Offers | 10% | Active = Full |
| Payment Options | 10% | All enabled = Full |

#### 9.3.3 Tab: Hiá»‡u quáº£ chÆ°Æ¡ng trÃ¬nh (ROI Calculator)

**Component:** `ROICalculator.tsx`
**Header:** "Hiá»‡u quáº£ chÆ°Æ¡ng trÃ¬nh"
**Subtitle:** "TÃ­nh lá»£i nhuáº­n khi tham gia chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i OTA"

**Inputs:**

| Field | Type | Default | Validation |
|-------|------|---------|------------|
| GiÃ¡ phÃ²ng gá»‘c (BAR) | Currency (VND) | 1,000,000 | > 0 |
| Commission (%) | Percentage | 18% | 0â€“100 |
| Discount (%) | Percentage | 10% | 0â€“99 |
| Chi phÃ­ biáº¿n Ä‘á»•i/phÃ²ng | Currency (VND) | 200,000 | â‰¥ 0 |
| Sá»‘ phÃ²ng dá»± kiáº¿n | Number | 30 | â‰¥ 1 |
| Increase % (boost) | Percentage | 20% | â‰¥ 0 |

**Outputs:** Revenue comparison (with/without program), Profit/Loss, ROI %, Breakeven
**Currency format:** VND with 2 decimal places

#### 9.3.4 Tab: Äiá»ƒm Review (Review Calculator)

**Component:** `ReviewCalculator.tsx`
**Header:** "CÃ¡ch tÃ­nh Ä‘iá»ƒm Ä‘Ã¡nh giÃ¡"
**Subtitle:** "Impact Simulator â€” xem 1 review má»›i sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n Ä‘iá»ƒm tá»•ng tháº¿ nÃ o? Target Calculator â€” cáº§n bao nhiÃªu review 5â­ Ä‘á»ƒ Ä‘áº¡t má»¥c tiÃªu?"

**Two Modes:**

| Mode | Label (VI) | Function |
|------|------------|----------|
| Impact Simulator | **MÃ´ phá»ng tÃ¡c Ä‘á»™ng** | Calculate: `newScore = (oldScore Ã— totalReviews + newRating Ã— newCount) / (totalReviews + newCount)` |
| Target Calculator | **Má»¥c tiÃªu Ä‘iá»ƒm sá»‘** | Calculate reviews needed to reach target score |

#### 9.3.5 Tab: CÃ¡ch tÄƒng Ranking (When to Boost)

**Component:** `WhenToBoost.tsx`
**Header:** "Khi nÃ o nÃªn Äáº©y máº¡nh TÄƒng Ranking?"
**Subtitle:** "NguyÃªn táº¯c tÄƒng Ranking hiá»‡u quáº£ dá»±a trÃªn tÃ¬nh huá»‘ng thá»±c táº¿"

**Scenario-Based Decision Guide:**

| Scenario | Recommendation | Reason |
|----------|---------------|--------|
| Low season + high vacancy | âœ… Boost aggressively | More inventory to fill |
| High season + low vacancy | âŒ Skip boost | Already selling well |
| New listing (< 3 months) | âœ… Boost for visibility | Build initial ranking |
| Post-renovation | âœ… Boost + new photos | Re-establish position |
| Competitor price war | âš ï¸ Boost cautiously | Avoid margin erosion |

---

## 10. Error States & Messages

### 10.1 Error Display Patterns

| Error Type | Display | Action |
|------------|---------|--------|
| Network | Toast + retry button | Retry API call |
| Validation | Inline field error | Fix input |
| Permission | Full page block | Contact admin |
| Server | Toast + support link | Report issue |

### 10.2 Error Message Mapping

| Technical Error | User Message (VN) |
|-----------------|-------------------|
| `ECONNRESET` | Máº¥t káº¿t ná»‘i. Vui lÃ²ng thá»­ láº¡i. |
| `401 Unauthorized` | PhiÃªn Ä‘Äƒng nháº­p háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i. |
| `403 Forbidden` | Báº¡n khÃ´ng cÃ³ quyá»n thá»±c hiá»‡n thao tÃ¡c nÃ y. |
| `404 Not Found` | KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u. |
| `422 Validation` | Dá»¯ liá»‡u khÃ´ng há»£p lá»‡. Vui lÃ²ng kiá»ƒm tra láº¡i. |
| `500 Server Error` | Lá»—i há»‡ thá»‘ng. Vui lÃ²ng thá»­ láº¡i sau. |

---

## 11. Appendix

### 11.1 State Diagrams

#### Import Job States
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDINGâ”‚â”€â”€â”€â–¶â”‚ PROCESSINGâ”‚â”€â”€â”€â–¶â”‚ SUCCESS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ FAILED  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Pricing Decision States
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚â”€â”€â”€â–¶â”‚ ACCEPTED â”‚    â”‚ OVERRIDDENâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â–²
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 Keyboard Shortcuts

| Shortcut | Action | Page |
|----------|--------|------|
| `Ctrl+K` | Quick search | Global |
| `Escape` | Close modal | Global |
| `Enter` | Submit form | Forms |
| `A` | Accept price | Dashboard |
| `O` | Override price | Dashboard |

### 11.3 Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-20 | Eng | Initial FSD |
| 1.2 | 2026-02-01 | Eng | Added OTA module |
| 1.4 | 2026-02-09 | Eng | Added Analytics, Guide |
| 1.5 | 2026-02-10 | Eng | Added OTA Growth Playbook module (6 tabs) |

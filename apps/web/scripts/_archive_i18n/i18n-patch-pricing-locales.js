/**
 * i18n Patch: Add proper id/ms/th translations for pricing components
 * This overwrites the English fallback keys that were incorrectly set.
 */

const fs = require('fs');
const path = require('path');

const MESSAGES_DIR = path.join(__dirname, '..', 'messages');

// ── Indonesian (id) translations ────────────────────────────────────

const ID_KEYS = {
    seasonConfigPanel: {
        title: "Musim",
        createTooltip: "Buat {name}",
        errorLabel: "Error:",
        noSeasons: "Belum ada musim. Klik tombol di atas untuk membuat.",
        multiplierLabel: "Pengali (harga rack = harga dasar × pengali):",
        dateRanges: "Rentang Tanggal:",
        addDateRange: "Tambah",
        save: "Simpan",
        ranges: "{count} rentang",
        confirmDelete: "Hapus musim ini? Data harga NET terkait juga akan dihapus.",
        createFailed: "Gagal membuat",
        updateFailed: "Gagal memperbarui",
        deleteFailed: "Gagal menghapus",
    },
    occTierEditor: {
        title: "Tingkat Okupansi (OCC Tiers)",
        unsaved: "Belum disimpan",
        addTier: "Tambah Tingkat",
        deleteLast: "Hapus Tingkat Terakhir",
        from: "Dari",
        to: "Ke",
        type: "Tipe",
        adjustment: "Penyesuaian",
        useMultiplierTooltip: "Menggunakan pengali (×). Klik untuk beralih ke jumlah (₫)",
        useAmountTooltip: "Menggunakan jumlah (₫). Klik untuk beralih ke pengali (×)",
        errMinGteMax: "min ≥ max",
        errMultiplierRange: "Pengali di luar 0.5–3.0",
        errNotContinuous: "tidak berkesinambungan — tingkat sebelumnya berakhir di {pct}%",
        errMustStartZero: "harus dimulai dari 0%",
        errMustEndHundred: "harus berakhir di 100%",
        errNeedThreeTiers: "Minimal 3 tingkat diperlukan",
        errMaxSixTiers: "Maksimal 6 tingkat",
        errTierMinGteMax: "Tingkat {idx}: min ≥ max",
        errTierMultiplier: "Tingkat {idx}: pengali di luar 0.5–3.0",
        errTierNotContinuous: "Tingkat {idx}: tidak berkesinambungan dengan tingkat {prevIdx}",
        errFirstTierStart: "Tingkat pertama harus dimulai dari 0%",
        errLastTierEnd: "Tingkat terakhir harus berakhir di 100%",
        savedSuccess: "Berhasil disimpan!",
        saveButton: "Simpan OCC Tiers",
        saved: "Tersimpan",
        saveFailed: "Gagal menyimpan",
    },
    seasonRateEditor: {
        netRatesFor: "Harga NET untuk {seasonName}:",
        ratesSaved: "Harga berhasil disimpan!",
        saveNetRates: "Simpan harga NET",
        failedToSaveRates: "Gagal menyimpan harga",
        saveFailed: "Gagal menyimpan",
    },
    otaConfigTab: {
        title: "Saluran OTA",
        addChannel: "Tambah Saluran OTA",
        editChannel: "Edit Saluran OTA",
        channelName: "Nama Saluran *",
        channelCode: "Kode Saluran *",
        commission: "Komisi (%) *",
        calcMode: "Mode Perhitungan",
        progressive: "Progressive — Progresif",
        additive: "Additive — Aditif",
        active: "Aktif",
        cancel: "Batal",
        update: "Perbarui",
        add: "Tambah",
        noChannels: "Belum ada saluran OTA. Klik \"Tambah Saluran OTA\" untuk memulai.",
        thOtaChannel: "Saluran OTA",
        thCode: "Kode",
        thCommission: "Komisi",
        thCalcMode: "Mode Hitung",
        thStatus: "Status",
        thActions: "Aksi",
        confirmDelete: "Konfirmasi hapus saluran OTA ini?",
        progressiveLabel: "Progressive",
        additiveLabel: "Additive",
    },
    overviewTab: {
        calculating: "Menghitung...",
        eachCellShows: "Setiap sel menampilkan:",
        guestPriceDisplay: "Harga Tamu (Tampilan)",
        netRevenueLabel: "Pendapatan Bersih",
        barPriceInput: "Harga BAR (input CM)",
        retentionRate: "Tingkat retensi:",
        retHigh: ">75%",
        retMid: "50–75%",
        retLow: "<50%",
        enterDisplayPrice: "Masukkan harga tampilan",
        baseNetPrice: "Harga NET dasar",
        noPriceSet: "Belum ada harga",
        guestSees: "Tamu Lihat",
        revenue: "Pendapatan",
        noDetails: "Tidak ada detail",
        tooltipBar: "BAR:",
        tooltipDisplay: "Tampilan:",
        tooltipRevenue: "Pendapatan:",
        tooltipKm: "KM:",
        demoExportPdf: "Fitur ini tidak tersedia untuk Hotel Demo",
        exportPdf: "Ekspor PDF",
        demoExportCsv: "Fitur ini tidak tersedia untuk Hotel Demo",
        exportCsv: "Ekspor CSV",
    },
    dynamicTab: {
        drilldownTier: "Tingkat:",
        netBaseSeason: "NET dasar ({season})",
        addFixed: "+ Tambah (Tetap) (+{amount})",
        xMultiplier: "× Pengali (×{value})",
        barChannel: "BAR ({channel} {pct}%)",
        displayKm: "Tampilan (KM -{pct}%)",
        guardrailMin: "Min:",
        guardrailMax: "Maks:",
        guardrailOk: "OK",
        guardrailMinMax: "min {min} / maks {max}",
        adjustmentFixed: "Penyesuaian: +{amount}",
        adjustmentMultiplier: "Pengali: ×{value}",
        adjustmentUnchanged: "(tidak berubah)",
        averageDiscount: "Rata-rata: {pct}%",
        demoExport: "Fitur ini tidak tersedia untuk Hotel Demo",
        exportCsvTitle: "Ekspor CSV",
    },
};

// ── Malay (ms) translations ─────────────────────────────────────────

const MS_KEYS = {
    seasonConfigPanel: {
        title: "Musim",
        createTooltip: "Cipta {name}",
        errorLabel: "Ralat:",
        noSeasons: "Tiada musim lagi. Klik butang di atas untuk mencipta.",
        multiplierLabel: "Pengganda (harga rak = harga asas × pengganda):",
        dateRanges: "Julat Tarikh:",
        addDateRange: "Tambah",
        save: "Simpan",
        ranges: "{count} julat",
        confirmDelete: "Padam musim ini? Data harga NET berkaitan juga akan dipadam.",
        createFailed: "Gagal mencipta",
        updateFailed: "Gagal mengemas kini",
        deleteFailed: "Gagal memadam",
    },
    occTierEditor: {
        title: "Tahap Penghunian (OCC Tiers)",
        unsaved: "Belum disimpan",
        addTier: "Tambah Tahap",
        deleteLast: "Padam Tahap Terakhir",
        from: "Dari",
        to: "Ke",
        type: "Jenis",
        adjustment: "Pelarasan",
        useMultiplierTooltip: "Menggunakan pengganda (×). Klik untuk tukar ke jumlah (₫)",
        useAmountTooltip: "Menggunakan jumlah (₫). Klik untuk tukar ke pengganda (×)",
        errMinGteMax: "min ≥ max",
        errMultiplierRange: "Pengganda di luar 0.5–3.0",
        errNotContinuous: "tidak berterusan — tahap sebelumnya berakhir di {pct}%",
        errMustStartZero: "mesti bermula dari 0%",
        errMustEndHundred: "mesti berakhir di 100%",
        errNeedThreeTiers: "Minimum 3 tahap diperlukan",
        errMaxSixTiers: "Maksimum 6 tahap",
        errTierMinGteMax: "Tahap {idx}: min ≥ max",
        errTierMultiplier: "Tahap {idx}: pengganda di luar 0.5–3.0",
        errTierNotContinuous: "Tahap {idx}: tidak berterusan dengan tahap {prevIdx}",
        errFirstTierStart: "Tahap pertama mesti bermula dari 0%",
        errLastTierEnd: "Tahap terakhir mesti berakhir di 100%",
        savedSuccess: "Berjaya disimpan!",
        saveButton: "Simpan OCC Tiers",
        saved: "Tersimpan",
        saveFailed: "Gagal menyimpan",
    },
    seasonRateEditor: {
        netRatesFor: "Harga NET untuk {seasonName}:",
        ratesSaved: "Harga berjaya disimpan!",
        saveNetRates: "Simpan harga NET",
        failedToSaveRates: "Gagal menyimpan harga",
        saveFailed: "Gagal menyimpan",
    },
    otaConfigTab: {
        title: "Saluran OTA",
        addChannel: "Tambah Saluran OTA",
        editChannel: "Edit Saluran OTA",
        channelName: "Nama Saluran *",
        channelCode: "Kod Saluran *",
        commission: "Komisen (%) *",
        calcMode: "Mod Pengiraan",
        progressive: "Progressive — Progresif",
        additive: "Additive — Aditif",
        active: "Aktif",
        cancel: "Batal",
        update: "Kemas Kini",
        add: "Tambah",
        noChannels: "Tiada saluran OTA lagi. Klik \"Tambah Saluran OTA\" untuk bermula.",
        thOtaChannel: "Saluran OTA",
        thCode: "Kod",
        thCommission: "Komisen",
        thCalcMode: "Mod Kira",
        thStatus: "Status",
        thActions: "Tindakan",
        confirmDelete: "Sahkan padam saluran OTA ini?",
        progressiveLabel: "Progressive",
        additiveLabel: "Additive",
    },
    overviewTab: {
        calculating: "Mengira...",
        eachCellShows: "Setiap sel menunjukkan:",
        guestPriceDisplay: "Harga Tetamu (Paparan)",
        netRevenueLabel: "Hasil Bersih",
        barPriceInput: "Harga BAR (input CM)",
        retentionRate: "Kadar pengekalan:",
        retHigh: ">75%",
        retMid: "50–75%",
        retLow: "<50%",
        enterDisplayPrice: "Masukkan harga paparan",
        baseNetPrice: "Harga NET asas",
        noPriceSet: "Tiada harga ditetapkan",
        guestSees: "Tetamu Lihat",
        revenue: "Hasil",
        noDetails: "Tiada butiran",
        tooltipBar: "BAR:",
        tooltipDisplay: "Paparan:",
        tooltipRevenue: "Hasil:",
        tooltipKm: "KM:",
        demoExportPdf: "Ciri ini tidak tersedia untuk Hotel Demo",
        exportPdf: "Eksport PDF",
        demoExportCsv: "Ciri ini tidak tersedia untuk Hotel Demo",
        exportCsv: "Eksport CSV",
    },
    dynamicTab: {
        drilldownTier: "Tahap:",
        netBaseSeason: "NET asas ({season})",
        addFixed: "+ Tambah (Tetap) (+{amount})",
        xMultiplier: "× Pengganda (×{value})",
        barChannel: "BAR ({channel} {pct}%)",
        displayKm: "Paparan (KM -{pct}%)",
        guardrailMin: "Min:",
        guardrailMax: "Maks:",
        guardrailOk: "OK",
        guardrailMinMax: "min {min} / maks {max}",
        adjustmentFixed: "Pelarasan: +{amount}",
        adjustmentMultiplier: "Pengganda: ×{value}",
        adjustmentUnchanged: "(tidak berubah)",
        averageDiscount: "Purata: {pct}%",
        demoExport: "Ciri ini tidak tersedia untuk Hotel Demo",
        exportCsvTitle: "Eksport CSV",
    },
};

// ── Thai (th) translations ──────────────────────────────────────────

const TH_KEYS = {
    seasonConfigPanel: {
        title: "ฤดูกาล",
        createTooltip: "สร้าง {name}",
        errorLabel: "ข้อผิดพลาด:",
        noSeasons: "ยังไม่มีฤดูกาล คลิกปุ่มด้านบนเพื่อสร้าง",
        multiplierLabel: "ตัวคูณ (ราคา rack = ราคาฐาน × ตัวคูณ):",
        dateRanges: "ช่วงวันที่:",
        addDateRange: "เพิ่ม",
        save: "บันทึก",
        ranges: "{count} ช่วง",
        confirmDelete: "ลบฤดูกาลนี้? ข้อมูลราคา NET ที่เกี่ยวข้องจะถูกลบด้วย",
        createFailed: "สร้างไม่สำเร็จ",
        updateFailed: "อัปเดตไม่สำเร็จ",
        deleteFailed: "ลบไม่สำเร็จ",
    },
    occTierEditor: {
        title: "ระดับอัตราเข้าพัก (OCC Tiers)",
        unsaved: "ยังไม่ได้บันทึก",
        addTier: "เพิ่มระดับ",
        deleteLast: "ลบระดับสุดท้าย",
        from: "จาก",
        to: "ถึง",
        type: "ประเภท",
        adjustment: "การปรับ",
        useMultiplierTooltip: "ใช้ตัวคูณ (×) คลิกเพื่อเปลี่ยนเป็นจำนวน (₫)",
        useAmountTooltip: "ใช้จำนวน (₫) คลิกเพื่อเปลี่ยนเป็นตัวคูณ (×)",
        errMinGteMax: "min ≥ max",
        errMultiplierRange: "ตัวคูณนอกช่วง 0.5–3.0",
        errNotContinuous: "ไม่ต่อเนื่อง — ระดับก่อนหน้าสิ้นสุดที่ {pct}%",
        errMustStartZero: "ต้องเริ่มที่ 0%",
        errMustEndHundred: "ต้องสิ้นสุดที่ 100%",
        errNeedThreeTiers: "ต้องมีอย่างน้อย 3 ระดับ",
        errMaxSixTiers: "สูงสุด 6 ระดับ",
        errTierMinGteMax: "ระดับ {idx}: min ≥ max",
        errTierMultiplier: "ระดับ {idx}: ตัวคูณนอกช่วง 0.5–3.0",
        errTierNotContinuous: "ระดับ {idx}: ไม่ต่อเนื่องกับระดับ {prevIdx}",
        errFirstTierStart: "ระดับแรกต้องเริ่มที่ 0%",
        errLastTierEnd: "ระดับสุดท้ายต้องสิ้นสุดที่ 100%",
        savedSuccess: "บันทึกสำเร็จ!",
        saveButton: "บันทึก OCC Tiers",
        saved: "บันทึกแล้ว",
        saveFailed: "บันทึกไม่สำเร็จ",
    },
    seasonRateEditor: {
        netRatesFor: "ราคา NET สำหรับ {seasonName}:",
        ratesSaved: "บันทึกราคาสำเร็จ!",
        saveNetRates: "บันทึกราคา NET",
        failedToSaveRates: "บันทึกราคาไม่สำเร็จ",
        saveFailed: "บันทึกไม่สำเร็จ",
    },
    otaConfigTab: {
        title: "ช่องทาง OTA",
        addChannel: "เพิ่มช่องทาง OTA",
        editChannel: "แก้ไขช่องทาง OTA",
        channelName: "ชื่อช่องทาง *",
        channelCode: "รหัสช่องทาง *",
        commission: "ค่าคอมมิชชัน (%) *",
        calcMode: "โหมดการคำนวณ",
        progressive: "Progressive — แบบก้าวหน้า",
        additive: "Additive — แบบบวกสะสม",
        active: "ใช้งาน",
        cancel: "ยกเลิก",
        update: "อัปเดต",
        add: "เพิ่ม",
        noChannels: "ยังไม่มีช่องทาง OTA คลิก \"เพิ่มช่องทาง OTA\" เพื่อเริ่มต้น",
        thOtaChannel: "ช่องทาง OTA",
        thCode: "รหัส",
        thCommission: "ค่าคอมมิชชัน",
        thCalcMode: "โหมดคำนวณ",
        thStatus: "สถานะ",
        thActions: "การดำเนินการ",
        confirmDelete: "ยืนยันลบช่องทาง OTA นี้?",
        progressiveLabel: "Progressive",
        additiveLabel: "Additive",
    },
    overviewTab: {
        calculating: "กำลังคำนวณ...",
        eachCellShows: "แต่ละเซลล์แสดง:",
        guestPriceDisplay: "ราคาแขก (แสดง)",
        netRevenueLabel: "รายได้สุทธิ",
        barPriceInput: "ราคา BAR (อินพุต CM)",
        retentionRate: "อัตราการรักษา:",
        retHigh: ">75%",
        retMid: "50–75%",
        retLow: "<50%",
        enterDisplayPrice: "ป้อนราคาแสดง",
        baseNetPrice: "ราคา NET พื้นฐาน",
        noPriceSet: "ยังไม่ได้ตั้งราคา",
        guestSees: "แขกเห็น",
        revenue: "รายได้",
        noDetails: "ไม่มีรายละเอียด",
        tooltipBar: "BAR:",
        tooltipDisplay: "แสดง:",
        tooltipRevenue: "รายได้:",
        tooltipKm: "KM:",
        demoExportPdf: "ฟีเจอร์นี้ไม่พร้อมใช้งานสำหรับโรงแรมตัวอย่าง",
        exportPdf: "ส่งออก PDF",
        demoExportCsv: "ฟีเจอร์นี้ไม่พร้อมใช้งานสำหรับโรงแรมตัวอย่าง",
        exportCsv: "ส่งออก CSV",
    },
    dynamicTab: {
        drilldownTier: "ระดับ:",
        netBaseSeason: "NET พื้นฐาน ({season})",
        addFixed: "+ เพิ่ม (คงที่) (+{amount})",
        xMultiplier: "× ตัวคูณ (×{value})",
        barChannel: "BAR ({channel} {pct}%)",
        displayKm: "แสดง (KM -{pct}%)",
        guardrailMin: "ต่ำสุด:",
        guardrailMax: "สูงสุด:",
        guardrailOk: "OK",
        guardrailMinMax: "ต่ำสุด {min} / สูงสุด {max}",
        adjustmentFixed: "การปรับ: +{amount}",
        adjustmentMultiplier: "ตัวคูณ: ×{value}",
        adjustmentUnchanged: "(ไม่เปลี่ยนแปลง)",
        averageDiscount: "เฉลี่ย: {pct}%",
        demoExport: "ฟีเจอร์นี้ไม่พร้อมใช้งานสำหรับโรงแรมตัวอย่าง",
        exportCsvTitle: "ส่งออก CSV",
    },
};

// ── Main ────────────────────────────────────────────────────────────

const LOCALE_MAP = {
    id: ID_KEYS,
    ms: MS_KEYS,
    th: TH_KEYS,
};

function patchLocale(locale, translations) {
    const filePath = path.join(MESSAGES_DIR, `${locale}.json`);
    const data = JSON.parse(fs.readFileSync(filePath, 'utf8'));

    let updated = 0;

    for (const [ns, keys] of Object.entries(translations)) {
        if (!data[ns]) data[ns] = {};
        for (const [key, value] of Object.entries(keys)) {
            // Overwrite English fallback with proper translation
            data[ns][key] = value;
            updated++;
        }
    }

    fs.writeFileSync(filePath, JSON.stringify(data, null, 2) + '\n', 'utf8');
    console.log(`  ${locale}.json → updated ${updated} keys`);
}

console.log('Patching id/ms/th with proper translations...\n');
for (const [locale, translations] of Object.entries(LOCALE_MAP)) {
    patchLocale(locale, translations);
}
console.log('\nDone!');

{
  "updated_at": "2026-02-17T12:34:00+07:00",
  "working_on": {
    "feature": "Dashboard V2 Panels + Analytics Pipeline Finalization",
    "task": "Integrated 3 V2 panels into dashboard, updated dailyAction for cancel-aware occupancy, brainstormed Distribution & Conversion Clinic",
    "status": "completed",
    "files": [
      "apps/web/app/dashboard/page.tsx",
      "apps/web/lib/engine/dailyAction.ts"
    ],
    "blockers": [],
    "notes": "Commit bdd5d0e pushed. All 41 cancel forecast tests pass. Brainstorm analysis complete for next feature."
  },
  "pending_tasks": [
    {
      "task": "Switch PayPal from Sandbox to Live",
      "priority": "critical",
      "notes": "Change 4 env vars on Vercel: PAYPAL_API_URL=https://api-m.paypal.com, PAYPAL_CLIENT_ID (Live), PAYPAL_SECRET (Live), PAYPAL_WEBHOOK_ID (Live webhook for production URL). Then redeploy."
    },
    {
      "task": "Add payment env vars to Vercel Dashboard (production)",
      "priority": "critical",
      "notes": "SEPAY_API_KEY, SEPAY_WEBHOOK_SECRET, SEPAY_BANK_ACCOUNT, SEPAY_BANK_NAME — then redeploy"
    },
    {
      "task": "Distribution & Conversion Clinic — Channel Revenue & Risk (P0)",
      "priority": "medium",
      "notes": "Brainstorm complete. Data exists in reservations_raw + OTAChannel.commission. Needs: 1 API route (channel-performance) + 1 UI component. See brainstorm at .gemini/antigravity/brain/09d320e7-*/brainstorm_distribution_clinic.md"
    },
    {
      "task": "Distribution & Conversion Clinic — Rate Calendar Grid UI (P0)",
      "priority": "medium",
      "notes": "Backend 85% done (PriceRecommendations + PricingDecision tables). Needs: Calendar heatmap UI + batch apply + publish workflow."
    },
    {
      "task": "Distribution & Conversion Clinic — ota_funnel_daily table + CSV import (P1)",
      "priority": "low",
      "notes": "Completely new: Prisma schema + import API + validation. Enables funnel dashboard per OTA."
    }
  ],
  "recent_changes": [
    {
      "timestamp": "2026-02-17T12:30:00+07:00",
      "type": "feature",
      "description": "Integrated 3 GM Dashboard V2 panels (TopAccountsTable, RoomLosMixPanel, LeadTimeBuckets) into dashboard Overview tab with Suspense wrapper. Updated dailyAction.ts to use net_remaining for cancel-aware occupancy calculation. Commit bdd5d0e.",
      "files": [
        "apps/web/app/dashboard/page.tsx",
        "apps/web/lib/engine/dailyAction.ts"
      ]
    },
    {
      "timestamp": "2026-02-17T12:24:00+07:00",
      "type": "analysis",
      "description": "Brainstormed Distribution & Conversion Clinic BA Spec v0.1 against codebase. Result: ~55% already built, ~20% needs UI only, ~25% needs new dev. Key gaps: ota_funnel_daily table, channel-performance API, calendar grid UI.",
      "files": []
    },
    {
      "timestamp": "2026-02-16T23:34:00+07:00",
      "type": "bugfix",
      "description": "Fixed onboarding redirect loop (part 2): Set rms_active_hotel cookie in /api/onboarding/complete response + use window.location.href instead of router.push for hard redirect. Commit e19562a.",
      "files": [
        "apps/web/app/api/onboarding/complete/route.ts",
        "apps/web/app/onboarding/page.tsx"
      ]
    }
  ],
  "errors_encountered": [
    {
      "error": "Onboarding → 'Vào Dashboard' redirects back to onboarding step 1 (stuck in loop)",
      "solution": "Root cause: JWT session has stale hasPendingActivation=true and accessibleHotels=[]. Fix: 1) Set rms_active_hotel cookie in /api/onboarding/complete response 2) Use window.location.href instead of router.push for hard page reload with fresh cookies.",
      "resolved": true,
      "file": "apps/web/app/onboarding/page.tsx"
    }
  ],
  "decisions_made": [
    {
      "decision": "Use net_remaining (cancel-aware) for occupancy calculation in dailyAction.ts",
      "reason": "FeaturesDaily already computes net_remaining = rooms_otb - expected_cxl via cancel forecast engine. Using this gives more accurate occupancy than raw capacity - roomsSold."
    },
    {
      "decision": "Wrap V2 dashboard panels in single Suspense boundary",
      "reason": "All 3 panels share same data dependency pattern. Single Suspense with skeleton fallback keeps UI responsive."
    },
    {
      "decision": "Distribution Clinic: prioritize Channel Revenue & Risk first (P0)",
      "reason": "Data already exists in reservations_raw + OTAChannel. Lowest effort, highest ROI. ota_funnel_daily needs new table + user CSV exports from OTA extranets."
    }
  ]
}
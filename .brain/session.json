{
  "updated_at": "2026-02-18T09:47:00+07:00",
  "working_on": {
    "feature": "Payment Gateway Live Deployment",
    "task": "SePay env vars added + PayPal switched from Sandbox to Live on Vercel",
    "status": "completed",
    "files": [],
    "blockers": [],
    "notes": "User confirmed: SePay env vars added to Vercel production, PayPal switched from Sandbox to Live (4 env vars updated). Payment gateway is now fully live."
  },
  "pending_tasks": [
    {
      "task": "Account Mapping Admin Page",
      "priority": "medium",
      "notes": "Quick fix done (Unknown → Direct/Walk-in). Need full admin page to let users map company_name to accounts/segments. Brainstorm needed."
    },
    {
      "task": "Distribution & Conversion Clinic — Channel Revenue & Risk (P0)",
      "priority": "medium",
      "notes": "Brainstorm complete. Data exists in reservations_raw + OTAChannel.commission. Needs: 1 API route (channel-performance) + 1 UI component."
    },
    {
      "task": "Manual Verification — Pricing Unification ACs",
      "priority": "high",
      "notes": "Run AC-1 to AC-9 on live app: STOP_SELL badge, delta rounding, deep-link preservation, mode toggle, Accept All logic."
    }
  ],
  "recent_changes": [
    {
      "timestamp": "2026-02-17T23:20:00+07:00",
      "type": "feature",
      "description": "Full Pipeline now includes OTB build: 6 steps — OTB(D-1) → OTB(D) → CancelStats → Features → Forecast → Pricing. Ensures DOD delta always has yesterday snapshot. Pipeline API handles 'buildOTB' action. Commit c2cc5d6.",
      "files": [
        "apps/web/components/analytics/FullPipelineButton.tsx",
        "apps/web/app/api/analytics/pipeline/route.ts"
      ]
    },
    {
      "timestamp": "2026-02-17T23:15:00+07:00",
      "type": "fix",
      "description": "KPI 'Còn trống' card: replaced meaningless '— 0' trend with 'X% đã bán' (sold percentage). Calculates from OTB / (capacity × 30 days). Commit 7556152.",
      "files": [
        "apps/web/components/dashboard/KpiCards.tsx"
      ]
    },
    {
      "timestamp": "2026-02-17T23:10:00+07:00",
      "type": "feature",
      "description": "Season multiplier from DB: (1) Added multiplier Float @default(1.0) to SeasonConfig schema, (2) Engine reads sc.multiplier from DB with legacy fallback, (3) API POST/PUT accept multiplier, (4) UI shows ×1.0/×1.2/×1.5 input in SeasonConfigPanel, (5) Existing rows seeded NORMAL=1.0, HIGH=1.2, HOLIDAY=1.5. Commit a03d438.",
      "files": [
        "apps/web/prisma/schema.prisma",
        "apps/web/app/actions/runPricingEngine.ts",
        "apps/web/app/api/pricing/seasons/route.ts",
        "apps/web/app/api/pricing/seasons/[id]/route.ts",
        "apps/web/components/pricing/SeasonConfigPanel.tsx"
      ]
    },
    {
      "timestamp": "2026-02-17T22:30:00+07:00",
      "type": "docs",
      "description": "Dashboard guide (/guide page): rewrote rec-table section with comprehensive guide on reading the dashboard — Quick/Detail modes, OTB vs Projected OCC, Anchor pricing, Zone→Multiplier table, ADR sanity banner, GM override guidance.",
      "files": [
        "apps/web/app/guide/page.tsx"
      ]
    },
    {
      "timestamp": "2026-02-17T21:14:00+07:00",
      "type": "feature",
      "description": "Added 'Hành động' badge + 'Lý do' column to RecommendationTable (Detailed Mode). Computes action/deltaPct/reasonTextVi from PricingLogic + OCC context in dashboard/page.tsx. Commit 0e5ca60.",
      "files": [
        "apps/web/components/dashboard/RecommendationTable.tsx",
        "apps/web/app/dashboard/page.tsx"
      ]
    }
  ],
  "errors_encountered": [
    {
      "error": "KPI 'Còn trống' card shows '— 0' instead of useful info",
      "solution": "Trend was set to 0 with empty label when remaining supply > 20. Replaced with calculated sold% (OTB / totalCapacity * 100), shows 'X% đã bán'.",
      "resolved": true,
      "file": "apps/web/components/dashboard/KpiCards.tsx"
    },
    {
      "error": "Analytics 'vs qua: 0 rms' always shows 0",
      "solution": "DOD compares today's OTB snapshot vs yesterday's. If no yesterday snapshot exists, delta is null/0. Fixed by adding OTB(D-1) step to Full Pipeline so yesterday's snapshot is always built before comparison.",
      "resolved": true,
      "file": "apps/web/components/analytics/FullPipelineButton.tsx"
    }
  ],
  "decisions_made": [
    {
      "decision": "Season multiplier stored in DB per hotel, not hardcoded",
      "reason": "Different hotels have different seasonal pricing strategies. NORMAL=1.0, HIGH=1.2, HOLIDAY=1.5 are defaults but GM can customize. Engine falls back to legacy values if DB multiplier is null."
    },
    {
      "decision": "Full Pipeline builds OTB for D-1 and D before running Features/Forecast/Pricing",
      "reason": "DOD (day-over-day) delta requires yesterday's OTB snapshot. Without it, 'vs qua' metric shows 0 or null. Pipeline now ensures both snapshots exist. /data page keeps separate OTB button for manual/bulk builds."
    },
    {
      "decision": "/data Build OTB button kept as-is (no D-1 auto-build)",
      "reason": "/data already builds by tier (daily/weekly/monthly) which usually covers D-1. Full Pipeline handles D-1+D for analytics DOD. Different tools, different purposes."
    }
  ]
}
{
  "updated_at": "2026-02-21T21:30:00+07:00",
  "working_on": {
    "feature": "OTA Pricing Engine — Vendor Stacking Audit & Fix",
    "task": "Completed: Traveloka TERA catalog, Trip.com Row-Column stacking fix, Expedia B2B net revenue. All pushed to main (b8bc277)",
    "status": "completed",
    "files": [
      "apps/web/lib/pricing/catalog.ts",
      "apps/web/lib/pricing/engine.ts",
      "apps/web/components/pricing/OverviewTab.tsx"
    ],
    "blockers": [],
    "notes": "Trip.com stacking now uses scenario-based Row-Column model matching Partner Center diagram. Traveloka has 9 promotions with TERA additive rules. Expedia B2B shows net revenue row."
  },
  "pending_tasks": [
    {
      "task": "guidePage i18n for id/ms/th",
      "priority": "medium",
      "notes": "~241 keys still English fallback. Largest remaining i18n gap. Need dedicated patch script."
    },
    {
      "task": "Account Mapping Admin Page",
      "priority": "medium",
      "notes": "Quick fix done (Unknown → Direct/Walk-in). Need full admin page for company_name mapping."
    },
    {
      "task": "Distribution & Conversion Clinic — Channel Revenue & Risk (P0)",
      "priority": "medium",
      "notes": "Brainstorm complete. Needs: 1 API route (channel-performance) + 1 UI component."
    },
    {
      "task": "Landing Page Redesign (when ready to re-enable)",
      "priority": "low",
      "notes": "pakhos.com redirected to rms.pakhos.com via vercel.json. Remove vercel.json to restore."
    },
    {
      "task": "Editable Commission Inline per OTA",
      "priority": "medium",
      "notes": "Planned earlier this session. Allows hotel to override default commission % directly in pricing overview."
    }
  ],
  "recent_changes": [
    {
      "timestamp": "2026-02-21T21:14:00+07:00",
      "type": "fix",
      "description": "Trip.com: Rewrote 7-box stacking with Row-Column scenario model. Box 1/3/4 non-stackable (horizontal), Box 2/5/6/7 stackable (vertical). Campaign only stacks with CoinPlus. Engine builds all valid scenarios and picks highest total discount.",
      "files": [
        "apps/web/lib/pricing/engine.ts"
      ]
    },
    {
      "timestamp": "2026-02-21T20:30:00+07:00",
      "type": "feature",
      "description": "Traveloka: Added TRAVELOKA_PROMOTIONS catalog (9 items) with TERA stacking rules. Campaign (3, EXCLUSIVE among self), Basic (4, stackable), Rate Channel (2, pick 1/subcategory). ADDITIVE mode. Wired into all helper functions.",
      "files": [
        "apps/web/lib/pricing/catalog.ts",
        "apps/web/lib/pricing/engine.ts"
      ]
    },
    {
      "timestamp": "2026-02-21T17:30:00+07:00",
      "type": "feature",
      "description": "Expedia B2B: Added net revenue row in OverviewTab for B2B merchant model channels. Shows NET after commission deduction.",
      "files": [
        "apps/web/components/pricing/OverviewTab.tsx"
      ]
    },
    {
      "timestamp": "2026-02-21T16:00:00+07:00",
      "type": "feature",
      "description": "Editable commission per OTA: Planned inline commission override feature for pricing overview. Implementation plan created.",
      "files": []
    }
  ],
  "errors_encountered": [
    {
      "error": "Trip.com stacking treated all 7 boxes as independently stackable — wrong per Partner Center diagram",
      "solution": "Rewrote with scenario-based Row-Column model: Box 1/3/4 non-stackable row, Box 2/5/6/7 stackable column. Picks best scenario.",
      "resolved": true
    },
    {
      "error": "Trip.com Campaign EXCLUSIVE blocked ALL boxes including CoinPlus",
      "solution": "Changed to scenario C: Campaign + CoinPlus (Box 7) only. User clarified: 'Campaign không stack với ai trừ CoinPlus'",
      "resolved": true
    },
    {
      "error": "git commit appeared stuck in terminal (no output for 10+ minutes)",
      "solution": "Command actually completed silently. Check git log --oneline to verify commit before retrying.",
      "resolved": true
    }
  ],
  "decisions_made": [
    {
      "decision": "Trip.com: Scenario-based stacking (deal-box vs package vs campaign)",
      "reason": "Partner Center diagram shows horizontal non-stackable row (Box 1/3/4) and vertical stackable column (Box 2/5/6/7). Each scenario has different stackable boxes."
    },
    {
      "decision": "Trip.com: Box 2 (Mobile Rate) only stacks with Box 1 (Deal Box)",
      "reason": "User clarified: 'basic deal và mobile rate sẽ ko stack với package'. Same column in diagram."
    },
    {
      "decision": "Trip.com: Campaign only stacks with CoinPlus (Box 7)",
      "reason": "User clarified: 'campaign là lớn nhất không stack với ai trừ Coinplus'. Most exclusive."
    },
    {
      "decision": "Traveloka: ADDITIVE stacking (campaign + basics + rate channels)",
      "reason": "Per TERA documentation. All groups stack additively. Only restriction: 1 campaign max."
    }
  ]
}
{
  "updated_at": "2026-02-22T17:41:00+07:00",
  "working_on": {
    "feature": "OTA Pricing Labels + Trip.com Stacking Fix",
    "task": "Completed: Renamed 'Doanh thu' → 'Giá thu về', 'Doanh thu thuần' → 'Giá thu về', 'Giá NET cơ sở' → 'Giá thu về' across 5 locales (vi/en/th/ms/id) in both overviewTab and promotionsTab. Rewrote Trip.com stacking logic from scenario-based exclusion to box-dedup + additive. Fixed pricing-plans feature descriptions. Added VND currency label.",
    "status": "completed",
    "files": [
      "apps/web/messages/vi.json",
      "apps/web/messages/en.json",
      "apps/web/messages/th.json",
      "apps/web/messages/ms.json",
      "apps/web/messages/id.json",
      "apps/web/lib/pricing/engine.ts",
      "apps/web/app/pricing-plans/page.tsx"
    ],
    "blockers": [],
    "notes": "All changes pushed to main. Vercel auto-deploys."
  },
  "pending_tasks": [
    {
      "task": "Account Mapping Admin Page",
      "priority": "medium",
      "notes": "Quick fix done (Unknown → Direct/Walk-in). Need full admin page for company_name mapping."
    },
    {
      "task": "Distribution & Conversion Clinic — Channel Revenue & Risk (P0)",
      "priority": "medium",
      "notes": "Brainstorm complete. Needs: 1 API route (channel-performance) + 1 UI component."
    },
    {
      "task": "Landing Page Redesign (when ready to re-enable)",
      "priority": "low",
      "notes": "pakhos.com redirected to rms.pakhos.com via vercel.json. Remove vercel.json to restore."
    },
    {
      "task": "Editable Commission Inline per OTA",
      "priority": "medium",
      "notes": "Planned earlier. Allows hotel to override default commission % directly in pricing overview."
    }
  ],
  "recent_changes": [
    {
      "timestamp": "2026-02-22T17:00:00+07:00",
      "type": "fix",
      "description": "Renamed all OTA pricing labels across 5 locales × 2 sections (overviewTab + promotionsTab): 'Doanh thu' → 'Giá thu về', 'Doanh thu thuần' → 'Giá thu về', 'Giá NET cơ sở' → 'Giá thu về'. Keys: netRevenue, netRevenueLabel, baseNetPrice, revenue, tooltipRevenue, netView, enterNetRevenue. EN equivalents: 'Revenue' → 'Hotel Revenue'.",
      "files": [
        "apps/web/messages/vi.json",
        "apps/web/messages/en.json",
        "apps/web/messages/th.json",
        "apps/web/messages/ms.json",
        "apps/web/messages/id.json"
      ]
    },
    {
      "timestamp": "2026-02-22T15:30:00+07:00",
      "type": "fix",
      "description": "Rewrote Trip.com stacking logic in resolveVendorStacking(): from scenario-based exclusion (Box1/3/4 mutually exclusive) to box-dedup + additive per BA diagram. Highest discount wins within each box, all box winners stack additively. Fixes lower-than-expected discount issue.",
      "files": [
        "apps/web/lib/pricing/engine.ts"
      ]
    },
    {
      "timestamp": "2026-02-22T13:00:00+07:00",
      "type": "fix",
      "description": "Updated pricing-plans page: fixed Superior tier feature descriptions to match actual plan features, added VND currency label, fixed hintKey TypeScript access with 'in' operator type narrowing.",
      "files": [
        "apps/web/app/pricing-plans/page.tsx"
      ]
    },
    {
      "timestamp": "2026-02-22T09:22:00+07:00",
      "type": "fix",
      "description": "Fixed 3 pre-existing TypeScript errors: nullish coalescing (?? 0) for optional count params in t() calls.",
      "files": [
        "apps/web/app/data/BuildFeaturesButton.tsx",
        "apps/web/app/data/RunForecastButton.tsx",
        "apps/web/app/upload/page.tsx"
      ]
    }
  ],
  "errors_encountered": [
    {
      "error": "Trip.com stacking logic gave lower-than-expected discounts",
      "solution": "Rewrote from scenario-based Box1/3/4 exclusion to box-dedup + additive. All box winners stack together additively.",
      "resolved": true
    },
    {
      "error": "TypeScript error accessing feature.hintKey on union type in pricing-plans page",
      "solution": "Used 'in' operator for type narrowing: 'hintKey' in feature && feature.hintKey",
      "resolved": true
    },
    {
      "error": "OTA pricing labels showing 'Doanh thu' instead of 'Giá thu về'",
      "solution": "Updated 7 keys across 5 locales in both overviewTab and promotionsTab sections",
      "resolved": true
    }
  ],
  "decisions_made": [
    {
      "decision": "Trip.com stacking: box-dedup + additive (not scenario-based)",
      "reason": "BA diagram shows all boxes stack additively. Previous scenario-based approach incorrectly treated Box1/3/4 as mutually exclusive, losing valid discounts."
    },
    {
      "decision": "Label 'Doanh thu' → 'Giá thu về' (not 'Giá KS thu về')",
      "reason": "User wants simpler, consistent label across all places. 'Giá thu về' = price received back by hotel."
    },
    {
      "decision": "Label 'Doanh thu thuần' → 'Giá thu về' (same as Doanh thu)",
      "reason": "User wants consistent terminology. Both refer to the same concept: what the hotel actually receives."
    }
  ]
}